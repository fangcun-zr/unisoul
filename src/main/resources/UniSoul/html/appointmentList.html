<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>预约管理 - UniSoul</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" rel="stylesheet">
    <link href="../css/appointmentList.css" rel="stylesheet">
</head>
<body>
<!-- 背景装饰 -->
<div class="background-decoration">
    <div class="circle c1"></div>
    <div class="circle c2"></div>
    <div class="circle c3"></div>
    <div class="floating-shapes">
        <div class="shape shape1"></div>
        <div class="shape shape2"></div>
        <div class="shape shape3"></div>
        <div class="shape shape4"></div>
    </div>
</div>

<!-- 导航栏 -->
<header class="header">
    <nav class="navbar navbar-expand-lg navbar-glass fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#">
                <div class="logo-wrapper">
                    <img src="../image/logo.png" alt="UniSoul Logo" class="nav-logo">
                    <span class="logo-text">UniSoul</span>
                </div>
            </a>
            <div class="nav-tools">
                <div class="user-info">
                    <div class="user-avatar">
                        <img src="../image/avatar.png" alt="User Avatar">
                        <span class="status-dot"></span>
                    </div>
                    <div class="user-details">
                        <span id="userName" class="user-name"></span>
                        <span id="userRole" class="user-role-badge"></span>
                    </div>
                </div>
            </div>
        </div>
    </nav>
</header>

<!-- 主要内容 -->
<main class="main-content">
    <div class="container">
        <!-- 统计卡片区域 -->
        <div class="stats-section mb-4">
            <div class="row">
                <div class="col-md-4">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="todayCount">0</h3>
                            <p>今日预约</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="pendingCount">0</h3>
                            <p>待处理预约</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="completedCount">0</h3>
                            <p>已完成预约</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- 左侧筛选面板 -->
            <div class="col-lg-3">
                <div class="filter-panel animate__animated animate__fadeInLeft">
                    <div class="panel-header">
                        <h4 id="filterTitle" class="panel-title">预约管理</h4>
                        <p id="filterSubtitle" class="panel-subtitle">筛选预约记录</p>
                    </div>

                    <div class="filter-body">
                        <!-- 医生专属筛选 -->
                        <div class="doctor-only filter-group" style="display: none;">
                            <label>患者类型</label>
                            <select id="patientTypeFilter" class="form-select">
                                <option value="">全部患者</option>
                                <option value="new">新患者</option>
                                <option value="returning">复诊患者</option>
                            </select>
                        </div>

                        <!-- 患者专属筛选 -->
                        <div class="patient-only filter-group" style="display: none;">
                            <label>科室选择</label>
                            <select id="departmentFilter" class="form-select">
                                <option value="">全部科室</option>
                                <option value="psychology">心理咨询</option>
                                <option value="psychiatry">精神科</option>
                            </select>
                        </div>

                        <!-- 通用筛选 -->
                        <div class="filter-group">
                            <label>预约状态</label>
                            <select id="statusFilter" class="form-select">
                                <option value="">全部状态</option>
                                <option value="pending">待确认</option>
                                <option value="confirmed">已确认</option>
                                <option value="completed">已完成</option>
                                <option value="cancelled">已取消</option>
                            </select>
                        </div>

                        <div class="filter-group">
                            <label>日期范围</label>
                            <input type="text" id="dateFilter" class="form-control" placeholder="选择日期范围">
                        </div>

                        <div class="filter-group">
                            <label>排序方式</label>
                            <select id="sortFilter" class="form-select">
                                <option value="time_desc">时间降序</option>
                                <option value="time_asc">时间升序</option>
                            </select>
                        </div>
                    </div>

                    <div class="panel-footer">
                        <button id="resetFilter" class="btn btn-outline-secondary w-100 mb-2">
                            <i class="fas fa-redo me-2"></i>重置筛选
                        </button>
                        <button id="exportBtn" class="btn btn-outline-primary w-100">
                            <i class="fas fa-download me-2"></i>导出记录
                        </button>
                    </div>
                </div>
            </div>

            <!-- 右侧预约列表 -->
            <div class="col-lg-9">
                <div class="appointment-panel animate__animated animate__fadeInRight">
                    <div class="panel-header">
                        <div class="header-left">
                            <h4 id="listTitle" class="section-title">预约列表</h4>
                            <span class="appointment-count">共 <span id="totalCount">0</span> 条记录</span>
                        </div>
                        <div class="header-right patient-only" style="display: none;">
                            <button class="btn btn-gradient" onclick="window.location.href='createAppointment.html'">
                                <i class="fas fa-plus me-2"></i>新建预约
                            </button>
                        </div>
                    </div>

                    <!-- 预约列表容器 -->
                    <div id="appointmentList" class="appointment-container">
                        <!-- 预约卡片将通过JS动态添加 -->
                    </div>

                    <!-- 空状态显示 -->
                    <div id="emptyState" class="empty-state text-center" style="display: none;">
                        <i class="fas fa-calendar-times mb-3"></i>
                        <h5 id="emptyStateText">暂无预约记录</h5>
                        <p id="emptyStateDesc" class="text-muted"></p>
                        <button id="createAppointmentBtn" class="btn btn-primary patient-only mt-3" style="display: none;">
                            立即预约
                        </button>
                    </div>

                    <!-- 分页控件 -->
                    <div class="pagination-wrapper">
                        <nav aria-label="预约列表分页">
                            <ul class="pagination justify-content-center">
                                <!-- 分页将通过JS动态生成 -->
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- 预约详情模态框 -->
<div class="modal fade" id="appointmentDetailModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">预约详情</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="appointmentDetailContent">
                <!-- 详情内容将通过JS动态填充 -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                <div id="appointmentActions">
                    <!-- 操作按钮将根据角色和状态动态生成 -->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 加载动画 -->
<div id="loadingSpinner" class="loading-overlay" style="display: none;">
    <div class="spinner-ripple">
        <div></div>
        <div></div>
    </div>
</div>

<!-- 脚本引用 -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/zh.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery-notify"></script>
<script src="../api/appointmentList.js"></script>
<script src="../js/appointmentList.js"></script>
</body>
</html>